(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["vendors~layout"],{1216:function(e,t,n){"use strict";n.d(t,"e",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return r})),n.d(t,"f",(function(){return a})),n.d(t,"b",(function(){return c}));const i="@signalwire:",o="add",s="remove",r="sessId";var a,c;(function(e){e["SocketOpen"]="signalwire.socket.open",e["SocketClose"]="signalwire.socket.close",e["SocketError"]="signalwire.socket.error",e["SocketMessage"]="signalwire.socket.message",e["SpeedTest"]="signalwire.internal.speedtest",e["Ready"]="signalwire.ready",e["Error"]="signalwire.error",e["Notification"]="signalwire.notification",e["Messages"]="signalwire.messages",e["Calls"]="signalwire.calls",e["MediaError"]="signalwire.rtc.mediaError"})(a||(a={})),function(e){e["Broadcast"]="blade.broadcast",e["Disconnect"]="blade.disconnect"}(c||(c={}))},"1da1":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n("d3b7");function i(e,t,n,i,o,s,r){try{var a=e[s](r),c=a.value}catch(l){return void n(l)}a.done?t(c):Promise.resolve(c).then(i,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,s){var r=e.apply(t,n);function a(e){i(r,o,s,a,c,"next",e)}function c(e){i(r,o,s,a,c,"throw",e)}a(void 0)}))}}},"25f0":function(e,t,n){"use strict";var i=n("5e77").PROPER,o=n("6eeb"),s=n("825a"),r=n("577e"),a=n("d039"),c=n("90d8"),l="toString",u=RegExp.prototype,d=u[l],h=a((function(){return"/a/b"!=d.call({source:"a",flags:"b"})})),f=i&&d.name!=l;(h||f)&&o(RegExp.prototype,l,(function(){var e=s(this),t=r(e.source),n=r(c(e));return"/"+t+"/"+n}),{unsafe:!0})},"30f8":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return u}));var i=n("84c8"),o=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function r(e){try{c(i.next(e))}catch(t){s(t)}}function a(e){try{c(i["throw"](e))}catch(t){s(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};const s=()=>"undefined"===typeof window&&"undefined"!==typeof e,r=(e,t)=>o(void 0,void 0,void 0,(function*(){if(s())return null;const n=window[e].getItem(Object(i["g"])(t));return Object(i["j"])(n)})),a=(e,t,n)=>o(void 0,void 0,void 0,(function*(){if(s())return null;"object"===typeof n&&(n=JSON.stringify(n)),window[e].setItem(Object(i["g"])(t),n)})),c=(e,t)=>o(void 0,void 0,void 0,(function*(){return s()?null:window[e].removeItem(Object(i["g"])(t))})),l={getItem:e=>r("localStorage",e),setItem:(e,t)=>a("localStorage",e,t),removeItem:e=>c("localStorage",e)},u={getItem:e=>r("sessionStorage",e),setItem:(e,t)=>a("sessionStorage",e,t),removeItem:e=>c("sessionStorage",e)}}).call(this,n("4362"))},"5c7d":function(e,t,n){(function(t,n){"use strict";"function"===typeof define&&define.amd?define(n):e.exports?e.exports=n():t.log=n()})(this,(function(){"use strict";var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function o(e,t){var n=e[t];if("function"===typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(i){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function r(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?o(console,i):void 0!==console.log?o(console,"log"):e)}function a(t,n){for(var o=0;o<i.length;o++){var s=i[o];this[s]=o<t?e:this.methodFactory(s,t,n)}this.log=this.debug}function c(e,n,i){return function(){typeof console!==t&&(a.call(this,n,i),this[e].apply(this,arguments))}}function l(e,t,n){return r(e)||c.apply(this,arguments)}function u(e,n,o){var s,r=this;n=null==n?"WARN":n;var c="loglevel";function u(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&c){try{return void(window.localStorage[c]=n)}catch(o){}try{window.document.cookie=encodeURIComponent(c)+"="+n+";"}catch(o){}}}function d(){var e;if(typeof window!==t&&c){try{e=window.localStorage[c]}catch(o){}if(typeof e===t)try{var n=window.document.cookie,i=n.indexOf(encodeURIComponent(c)+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i))[1])}catch(o){}return void 0===r.levels[e]&&(e=void 0),e}}function h(){if(typeof window!==t&&c){try{return void window.localStorage.removeItem(c)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}"string"===typeof e?c+=":"+e:"symbol"===typeof e&&(c=void 0),r.name=e,r.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},r.methodFactory=o||l,r.getLevel=function(){return s},r.setLevel=function(n,i){if("string"===typeof n&&void 0!==r.levels[n.toUpperCase()]&&(n=r.levels[n.toUpperCase()]),!("number"===typeof n&&n>=0&&n<=r.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(s=n,!1!==i&&u(n),a.call(r,n,e),typeof console===t&&n<r.levels.SILENT)return"No console available for logging"},r.setDefaultLevel=function(e){n=e,d()||r.setLevel(e,!1)},r.resetLevel=function(){r.setLevel(n,!1),h()},r.enableAll=function(e){r.setLevel(r.levels.TRACE,e)},r.disableAll=function(e){r.setLevel(r.levels.SILENT,e)};var f=d();null==f&&(f=n),r.setLevel(f,!1)}var d=new u,h={};d.getLogger=function(e){if("symbol"!==typeof e&&"string"!==typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=h[e];return t||(t=h[e]=new u(e,d.getLevel(),d.methodFactory)),t};var f=typeof window!==t?window.log:void 0;return d.noConflict=function(){return typeof window!==t&&window.log===d&&(window.log=f),d},d.getLoggers=function(){return h},d["default"]=d,d}))},6051:function(e,t,n){"use strict";var i=n("5c7d"),o=n.n(i);const s=()=>(new Date).toISOString().replace("T"," ").replace("Z",""),r=o.a.getLogger("signalwire"),a=r.methodFactory;r.methodFactory=(e,t,n)=>{const i=a(e,t,n);return function(){const e=[s(),"-"];for(let t=0;t<arguments.length;t++)e.push(arguments[t]);i.apply(void 0,e)}},r.setLevel(r.getLevel()),t["a"]=r},"84c8":function(e,t,n){"use strict";n.d(t,"h",(function(){return s})),n.d(t,"g",(function(){return r})),n.d(t,"f",(function(){return a})),n.d(t,"j",(function(){return c})),n.d(t,"d",(function(){return l})),n.d(t,"e",(function(){return u})),n.d(t,"c",(function(){return d})),n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return p})),n.d(t,"i",(function(){return v}));var i=n("6051"),o=n("1216");const s=e=>0===Object.keys(e).length,r=e=>`${o["e"]}${e}`,a=e=>{const[t,n,o,s,r,a]=e;let c={};try{c=JSON.parse(r.replace(/ID"/g,'Id"'))}catch(l){i["a"].warn("Verto LA invalid media JSON string:",r)}return{participantId:Number(t),participantNumber:n,participantName:o,codec:s,media:c,participantData:a}},c=e=>{if("string"!==typeof e)return e;try{return JSON.parse(e)}catch(t){return e}},l=e=>"undefined"!==typeof e,u=e=>e instanceof Function||"function"===typeof e,d=e=>"object"===typeof document&&"getElementById"in document?"string"===typeof e?document.getElementById(e)||null:"function"===typeof e?e():e instanceof HTMLMediaElement?e:null:null,h=/^(ws|wss):\/\//,f=e=>{const t=h.test(e)?"":"wss://";return`${t}${e}`},p=(e,t=null)=>{const{result:n={},error:i}=e;if(i)return{error:i};const{result:o=null}=n;if(null===o)return null!==t&&(n.node_id=t),{result:n};const{code:s=null,node_id:r=null,result:a=null}=o;return s&&"200"!==s?{error:o}:a?p(a,r):{result:o}},v=(e,t)=>Math.floor(Math.random()*(t-e+1)+e)},"90d8":function(e,t,n){var i=n("c65b"),o=n("1a2d"),s=n("3a9b"),r=n("ad6d"),a=RegExp.prototype;e.exports=function(e){var t=e.flags;return void 0!==t||"flags"in a||o(e,"flags")||!s(a,e)?t:i(r,e)}},"96cf":function(e,t,n){var i=function(e){"use strict";var t,n=Object.prototype,i=n.hasOwnProperty,o="function"===typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",r=o.asyncIterator||"@@asyncIterator",a=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(A){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var o=t&&t.prototype instanceof g?t:g,s=Object.create(o.prototype),r=new N(i||[]);return s._invoke=x(e,n,r),s}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(A){return{type:"throw",arg:A}}}e.wrap=l;var d="suspendedStart",h="suspendedYield",f="executing",p="completed",v={};function g(){}function m(){}function y(){}var b={};c(b,s,(function(){return this}));var _=Object.getPrototypeOf,w=_&&_(_(L([])));w&&w!==n&&i.call(w,s)&&(b=w);var S=y.prototype=g.prototype=Object.create(b);function I(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(o,s,r,a){var c=u(e[o],e,s);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"===typeof d&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,r,a)}),(function(e){n("throw",e,r,a)})):t.resolve(d).then((function(e){l.value=e,r(l)}),(function(e){return n("throw",e,r,a)}))}a(c.arg)}var o;function s(e,i){function s(){return new t((function(t,o){n(e,i,t,o)}))}return o=o?o.then(s,s):s()}this._invoke=s}function x(e,t,n){var i=d;return function(o,s){if(i===f)throw new Error("Generator is already running");if(i===p){if("throw"===o)throw s;return P()}n.method=o,n.arg=s;while(1){var r=n.delegate;if(r){var a=C(r,n);if(a){if(a===v)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===d)throw i=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var c=u(e,t,n);if("normal"===c.type){if(i=n.done?p:h,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=p,n.method="throw",n.arg=c.arg)}}}function C(e,n){var i=e.iterator[n.method];if(i===t){if(n.delegate=null,"throw"===n.method){if(e.iterator["return"]&&(n.method="return",n.arg=t,C(e,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=u(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var s=o.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function L(e){if(e){var n=e[s];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var o=-1,r=function n(){while(++o<e.length)if(i.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return r.next=r}}return{next:P}}function P(){return{value:t,done:!0}}return m.prototype=y,c(S,"constructor",y),c(y,"constructor",m),m.displayName=c(y,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,a,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},I(k.prototype),c(k.prototype,r,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,i,o,s){void 0===s&&(s=Promise);var r=new k(l(t,n,i,o),s);return e.isGeneratorFunction(n)?r:r.next().then((function(e){return e.done?e.value:r.next()}))},I(S),c(S,a,"Generator"),c(S,s,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){while(t.length){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=L,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(i,o){return a.type="throw",a.arg=e,n.next=i,o&&(n.method="next",n.arg=t),!!o}for(var s=this.tryEntries.length-1;s>=0;--s){var r=this.tryEntries[s],a=r.completion;if("root"===r.tryLoc)return o("end");if(r.tryLoc<=this.prev){var c=i.call(r,"catchLoc"),l=i.call(r,"finallyLoc");if(c&&l){if(this.prev<r.catchLoc)return o(r.catchLoc,!0);if(this.prev<r.finallyLoc)return o(r.finallyLoc)}else if(c){if(this.prev<r.catchLoc)return o(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return o(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&i.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var s=o;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var r=s?s.completion:{};return r.type=e,r.arg=t,s?(this.method="next",this.next=s.finallyLoc,v):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var o=i.arg;E(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:L(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=i}catch(o){"object"===typeof globalThis?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}},a131:function(e,t,n){"use strict";n.d(t,"a",(function(){return vt}));var i=n("6051"),o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),s=new Uint8Array(16);function r(){if(!o)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(s)}for(var a=[],c=0;c<256;++c)a[c]=(c+256).toString(16).substr(1);function l(e,t){var n=t||0,i=a;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")}var u=l;function d(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null),e=e||{};var o=e.random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var s=0;s<16;++s)t[i+s]=o[s];return t||u(o)}var h=d,f=n("1216"),p=n("84c8");const v="GLOBAL",g={},m=(e,t=v)=>g.hasOwnProperty(e)&&g[e].hasOwnProperty(t),y=(e,t,n=v)=>{g.hasOwnProperty(e)||(g[e]={}),g[e].hasOwnProperty(n)||(g[e][n]=[]),g[e][n].push(t)},b=(e,t,n=v)=>{const i=function(o){_(e,i,n),t(o)};return i.prototype.targetRef=t,y(e,i,n)},_=(e,t,n=v)=>{if(!m(e,n))return!1;if(Object(p["e"])(t)){const i=g[e][n].length;for(let o=i-1;o>=0;o--){const i=g[e][n][o];(t===i||i.prototype&&t===i.prototype.targetRef)&&g[e][n].splice(o,1)}}else g[e][n]=[];return 0===g[e][n].length&&(delete g[e][n],Object(p["h"])(g[e])&&delete g[e]),!0},w=(e,t,n=v,i=!0)=>{const o=i&&n!==v;if(!m(e,n))return o&&w(e,t),!1;const s=g[e][n].length;if(!s)return o&&w(e,t),!1;for(let r=s-1;r>=0;r--)g[e][n][r](t);return o&&w(e,t),!0},S=e=>{delete g[e]};let I="undefined"!==typeof WebSocket?WebSocket:null;const k={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},x=1e4;class C{constructor(e){this.session=e,this._wsClient=null,this._host="wss://relay.signalwire.com",this._timers={},this.upDur=null,this.downDur=null;const{host:t}=e.options;t&&(this._host=Object(p["a"])(t))}get connected(){return this._wsClient&&this._wsClient.readyState===k.OPEN}get connecting(){return this._wsClient&&this._wsClient.readyState===k.CONNECTING}get closing(){return this._wsClient&&this._wsClient.readyState===k.CLOSING}get closed(){return this._wsClient&&this._wsClient.readyState===k.CLOSED}get isAlive(){return this.connecting||this.connected}get isDead(){return this.closing||this.closed}connect(){this._wsClient=new I(this._host),this._wsClient.onopen=e=>w(f["f"].SocketOpen,e,this.session.uuid),this._wsClient.onclose=e=>w(f["f"].SocketClose,e,this.session.uuid),this._wsClient.onerror=e=>w(f["f"].SocketError,e,this.session.uuid),this._wsClient.onmessage=e=>{const t=Object(p["j"])(e.data);"string"!==typeof t?(this._unsetTimer(t.id),i["a"].debug("RECV: \n",JSON.stringify(t,null,2),"\n"),w(t.id,t)||w(f["f"].SocketMessage,t,this.session.uuid)):this._handleStringResponse(t)}}sendRawText(e){this._wsClient.send(e)}send(e){const{request:t}=e,n=new Promise((e,n)=>{if(t.hasOwnProperty("result"))return e();b(t.id,t=>{const{result:i,error:o}=Object(p["b"])(t);return o?n(o):e(i)}),this._setTimer(t.id)});return i["a"].debug("SEND: \n",JSON.stringify(t,null,2),"\n"),this._wsClient.send(JSON.stringify(t)),n}close(){this._wsClient&&(Object(p["e"])(this._wsClient._beginClose)?this._wsClient._beginClose():this._wsClient.close()),this._wsClient=null}_unsetTimer(e){clearTimeout(this._timers[e]),delete this._timers[e]}_setTimer(e){this._timers[e]=setTimeout(()=>{w(e,{error:{code:this.session.timeoutErrorCode,message:"Timeout"}}),this._unsetTimer(e)},x)}_handleStringResponse(e){if(/^#SP/.test(e))switch(e[3]){case"U":this.upDur=parseInt(e.substring(4));break;case"D":this.downDur=parseInt(e.substring(4)),w(f["f"].SpeedTest,{upDur:this.upDur,downDur:this.downDur},this.session.uuid);break}else i["a"].warn("Unknown message from socket",e)}}class O{buildRequest(e){this.request=Object.assign({jsonrpc:"2.0",id:h()},e)}}var E=O;const N=2,L=1,P=0;let A=null;const D=e=>{A=e};class j extends E{constructor(e,t){super(),this.method="blade.connect";const n={version:{major:N,minor:L,revision:P},authentication:e};t&&(n.sessionid=t),A&&(n.agent=A),this.buildRequest({method:this.method,params:n})}}class T extends E{constructor(e,t=""){let n;super(),this.method="blade.execute",n=e.hasOwnProperty("result")?{result:e}:{method:this.method,params:e},t&&(n.id=t),this.buildRequest(n)}}class R extends E{constructor(e){super(),this.method="blade.subscription",e.hasOwnProperty("auto_create")&&!e.auto_create&&delete e.auto_create,e.hasOwnProperty("downstream")&&!e.downstream&&delete e.downstream,this.buildRequest({method:this.method,params:e})}}class M extends E{constructor(e,t,n){super(),this.method="blade.reauthenticate";const i={sessionid:n,authentication:{project:e,jwt_token:t}};this.buildRequest({method:this.method,params:i})}}class U extends E{constructor(){super(),this.method="blade.ping",this.buildRequest({method:this.method,params:{}})}}var V=n("30f8"),$=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function r(e){try{c(i.next(e))}catch(t){s(t)}}function a(e){try{c(i["throw"](e))}catch(t){s(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};const B="signalwire",q="setup",F="notifications";var H=e=>$(void 0,void 0,void 0,(function*(){const t={},{signature:n,relayProtocol:o}=e;if(o&&o.split("_")[1]===n)t.protocol=o;else{const e=yield V["b"].getItem(n);e&&(t.protocol=e)}const s=new T({protocol:B,method:q,params:t}),{protocol:r=null}=yield e.execute(s);return r?(yield e.subscribe({protocol:r,channels:[F]}),yield V["b"].setItem(n,r)):i["a"].error("Error during setup the session protocol."),r})),J=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(n[i[o]]=e[i[o]])}return n};const G={id:"callID",destinationNumber:"destination_number",remoteCallerName:"remote_caller_id_name",remoteCallerNumber:"remote_caller_id_number",callerName:"caller_id_name",callerNumber:"caller_id_number"};class z extends E{constructor(e={}){if(super(),e.hasOwnProperty("dialogParams")){const t=e.dialogParams,{remoteSdp:n,localStream:i,remoteStream:o,onNotification:s,camId:r,micId:a,speakerId:c}=t,l=J(t,["remoteSdp","localStream","remoteStream","onNotification","camId","micId","speakerId"]);for(const e in G)e&&l.hasOwnProperty(e)&&(l[G[e]]=l[e],delete l[e]);e.dialogParams=l}this.buildRequest({method:this.toString(),params:e})}}class K extends z{constructor(e,t){super(),this.buildRequest({id:e,result:{method:t}})}}var Q,W,Y;(function(e){e["Offer"]="offer",e["Answer"]="answer"})(Q||(Q={})),function(e){e["Inbound"]="inbound",e["Outbound"]="outbound"}(W||(W={})),function(e){e["Invite"]="verto.invite",e["Attach"]="verto.attach",e["Answer"]="verto.answer",e["Info"]="verto.info",e["Display"]="verto.display",e["Media"]="verto.media",e["Event"]="verto.event",e["Bye"]="verto.bye",e["Punt"]="verto.punt",e["Broadcast"]="verto.broadcast",e["Subscribe"]="verto.subscribe",e["Unsubscribe"]="verto.unsubscribe",e["ClientReady"]="verto.clientReady",e["Modify"]="verto.modify"}(Y||(Y={}));const Z={generic:"event",[Y.Display]:"participantData",[Y.Attach]:"participantData",conferenceUpdate:"conferenceUpdate",callUpdate:"callUpdate",vertoClientReady:"vertoClientReady",userMediaError:"userMediaError",refreshToken:"refreshToken"},X={destinationNumber:"",remoteCallerName:"Outbound Call",remoteCallerNumber:"",callerName:"",callerNumber:"",audio:!0,video:!1,useStereo:!1,attach:!1,screenShare:!1,userVariables:{}};var ee,te,ne,ie;(function(e){e[e["New"]=0]="New",e[e["Requesting"]=1]="Requesting",e[e["Trying"]=2]="Trying",e[e["Recovering"]=3]="Recovering",e[e["Ringing"]=4]="Ringing",e[e["Answering"]=5]="Answering",e[e["Early"]=6]="Early",e[e["Active"]=7]="Active",e[e["Held"]=8]="Held",e[e["Hangup"]=9]="Hangup",e[e["Destroy"]=10]="Destroy",e[e["Purge"]=11]="Purge"})(ee||(ee={})),function(e){e["Participant"]="participant",e["Moderator"]="moderator"}(te||(te={})),function(e){e["Join"]="join",e["Leave"]="leave",e["Bootstrap"]="bootstrap",e["Add"]="add",e["Modify"]="modify",e["Delete"]="delete",e["Clear"]="clear",e["ChatMessage"]="chatMessage",e["LayerInfo"]="layerInfo",e["LogoInfo"]="logoInfo",e["LayoutInfo"]="layoutInfo",e["LayoutList"]="layoutList",e["ModCmdResponse"]="modCommandResponse"}(ne||(ne={})),function(e){e["Video"]="videoinput",e["AudioIn"]="audioinput",e["AudioOut"]="audiooutput"}(ie||(ie={}));class oe extends z{toString(){return Y.Invite}}class se extends z{toString(){return Y.Answer}}class re extends z{toString(){return Y.Attach}}class ae extends z{toString(){return Y.Bye}}class ce extends z{toString(){return Y.Modify}}class le extends z{toString(){return Y.Info}}class ue extends z{toString(){return Y.Broadcast}}class de extends z{toString(){return Y.Subscribe}}class he extends z{toString(){return Y.Unsubscribe}}var fe=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function r(e){try{c(i.next(e))}catch(t){s(t)}}function a(e){try{c(i["throw"](e))}catch(t){s(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};const pe=e=>new window.RTCPeerConnection(e),ve=e=>navigator.mediaDevices.getUserMedia(e),ge=e=>navigator.mediaDevices.getDisplayMedia(e),me=()=>navigator.mediaDevices.enumerateDevices(),ye=()=>navigator.mediaDevices.getSupportedConstraints(),be=e=>e&&e instanceof MediaStream,_e=(e,t)=>{const n=Object(p["c"])(e);null!==n&&(n.getAttribute("autoplay")||n.setAttribute("autoplay","autoplay"),n.getAttribute("playsinline")||n.setAttribute("playsinline","playsinline"),n.srcObject=t)},we=e=>{const t=Object(p["c"])(e);t&&(t.srcObject=null)},Se=e=>{const t=Object(p["c"])(e);t&&(t.muted=!0)},Ie=(e,t)=>fe(void 0,void 0,void 0,(function*(){const n=Object(p["c"])(e);if(null===n)return!1;try{return yield n.setSinkId(t),!0}catch(i){return!1}})),ke=e=>e,xe=e=>{be(e)&&e.getTracks().forEach(e=>e.stop()),e=null};var Ce=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function r(e){try{c(i.next(e))}catch(t){s(t)}}function a(e){try{c(i["throw"](e))}catch(t){s(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};const Oe=e=>Ce(void 0,void 0,void 0,(function*(){i["a"].info("RTCService.getUserMedia",e);const{audio:t,video:n}=e;if(!t&&!n)return null;try{return yield ve(e)}catch(o){throw i["a"].error("getUserMedia error: ",o),o}})),Ee=(e=null)=>({audio:!e||e===ie.AudioIn,video:!e||e===ie.Video}),Ne=(e=null,t=!1)=>Ce(void 0,void 0,void 0,(function*(){let n=yield me().catch(e=>[]);e&&(n=n.filter(t=>t.kind===e));const i=n.length&&n.every(e=>e.deviceId&&e.label);if(!i){const t=yield ve(Ee(e));return xe(t),Ne(e)}if(!0===t)return n;const o=[];return n=n.filter(({kind:e,groupId:t})=>{if(!t)return!0;const n=`${e}-${t}`;return!o.includes(n)&&(o.push(n),!0)}),n})),Le=[[320,240],[640,360],[640,480],[1280,720],[1920,1080]],Pe=e=>Ce(void 0,void 0,void 0,(function*(){const t=[],n=yield Oe({video:{deviceId:{exact:e}}}),i=n.getVideoTracks()[0];for(let e=0;e<Le.length;e++){const[n,o]=Le[e],s=yield i.applyConstraints({width:{exact:n},height:{exact:o}}).then(()=>!0).catch(()=>!1);s&&t.push({resolution:`${n}x${o}`,width:n,height:o})}return xe(n),t})),Ae=e=>Ce(void 0,void 0,void 0,(function*(){let{audio:t=!0,micId:n}=e;const{micLabel:i=""}=e;n&&(n=yield De(n,i,ie.AudioIn).catch(e=>null),n&&("boolean"===typeof t&&(t={}),t.deviceId={exact:n}));let{video:o=!1,camId:s}=e;const{camLabel:r=""}=e;return s&&(s=yield De(s,r,ie.Video).catch(e=>null),s&&("boolean"===typeof o&&(o={}),o.deviceId={exact:s})),{audio:t,video:o}})),De=(e,t,n)=>Ce(void 0,void 0,void 0,(function*(){const i=yield Ne(n,!0);for(let n=0;n<i.length;n++){const{deviceId:o,label:s}=i[n];if(e===o||t===s)return o}return null})),je=e=>{const t=ye();Object.keys(e).map(n=>{t.hasOwnProperty(n)&&null!==e[n]&&void 0!==e[n]||delete e[n]})},Te=(e,t,n,i)=>Ce(void 0,void 0,void 0,(function*(){const{deviceId:o}=i;if(!Object(p["d"])(o)&&(e||t)){const o=yield De(e,t,n).catch(e=>null);o&&(i.deviceId={exact:o})}return i})),Re=e=>{const t="\r\n",n=e.split(t),i=n.findIndex(e=>/^a=rtpmap/.test(e)&&/opus\/48000/.test(e));if(i<0)return e;const o=e=>{const t=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),n=e.match(t);return n&&2==n.length?n[1]:null},s=o(n[i]),r=new RegExp("a=fmtp:"+s),a=n.findIndex(e=>r.test(e));return a>=0?/stereo=1;/.test(n[a])||(n[a]+="; stereo=1; sprop-stereo=1"):n[i]+=`${t}a=fmtp:${s} stereo=1; sprop-stereo=1`,n.join(t)},Me=e=>/^m=audio/.test(e),Ue=e=>/^m=video/.test(e),Ve=(e,t)=>{const n="\r\n",i=t.split(n),o=i.findIndex(Me),s=i.findIndex(Ue);if(o<s)return e;const r=e.split(n),a=r.findIndex(Me),c=r.findIndex(Ue),l=r.slice(a,c),u=r.slice(c,r.length-1),d=r.slice(0,a);return[...d,...u,...l,""].join(n)},$e=(e,t)=>{if(!e)return!1;const{subscribed:n,alreadySubscribed:i}=Be(e);return n.includes(t)||i.includes(t)},Be=e=>{const t={subscribed:[],alreadySubscribed:[],unauthorized:[],unsubscribed:[],notSubscribed:[]};return Object.keys(t).forEach(n=>{t[n]=e[n+"Channels"]||[]}),t},qe=e=>{Ke(e,"audio",!0)},Fe=e=>{Ke(e,"audio",!1)},He=e=>{Ke(e,"audio",null)},Je=e=>{Ke(e,"video",!0)},Ge=e=>{Ke(e,"video",!1)},ze=e=>{Ke(e,"video",null)},Ke=(e,t=null,n=null)=>{if(!be(e))return null;let i=[];switch(t){case"audio":i=e.getAudioTracks();break;case"video":i=e.getVideoTracks();break;default:i=e.getTracks();break}i.forEach(e=>{switch(n){case"on":case!0:e.enabled=!0;break;case"off":case!1:e.enabled=!1;break;default:e.enabled=!e.enabled;break}})},Qe=(e,t,n,i)=>{const o="\r\n",s=e.split(o);return s.forEach((e,o)=>{/^a=fmtp:\d*/.test(e)?s[o]+=`;x-google-max-bitrate=${t};x-google-min-bitrate=${n};x-google-start-bitrate=${i}`:/^a=mid:(1|video)/.test(e)&&(s[o]+="\r\nb=AS:"+t)}),s.join(o)};var We=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function r(e){try{c(i.next(e))}catch(t){s(t)}}function a(e){try{c(i["throw"](e))}catch(t){s(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};class Ye{constructor(e,t){this.type=e,this.options=t,this.onSdpReadyTwice=null,this._negotiating=!1,i["a"].info("New Peer with type:",this.type,"Options:",this.options),this._constraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this._sdpReady=this._sdpReady.bind(this),this._init()}startNegotiation(){this._negotiating=!0,this._isOffer()?this._createOffer():this._createAnswer()}_init(){return We(this,void 0,void 0,(function*(){this.instance=pe(this._config()),this.instance.onsignalingstatechange=e=>{switch(this.instance.signalingState){case"stable":this._negotiating=!1;break;case"closed":this.instance=null;break;default:this._negotiating=!0}},this.instance.onnegotiationneeded=e=>{this._negotiating?i["a"].debug("Skip twice onnegotiationneeded.."):this.startNegotiation()},this.options.localStream=yield this._retrieveLocalStream().catch(e=>(w(f["f"].MediaError,e,this.options.id),null));const{localElement:e,localStream:t=null,screenShare:n=!1}=this.options;be(t)?("function"===typeof this.instance.addTrack?t.getTracks().forEach(e=>this.instance.addTrack(e,t)):this.instance.addStream(t),!0!==n&&(Se(e),_e(e,t))):null===t&&this.startNegotiation()}))}_createOffer(){this._isOffer()&&this.instance.createOffer(this._constraints).then(this._setLocalDescription.bind(this)).then(this._sdpReady).catch(e=>i["a"].error("Peer _createOffer error:",e))}_createAnswer(){if(!this._isAnswer())return;const{remoteSdp:e,useStereo:t}=this.options,n=t?Re(e):e,o=ke({sdp:n,type:Q.Offer});this.instance.setRemoteDescription(o).then(()=>this.instance.createAnswer()).then(this._setLocalDescription.bind(this)).then(this._sdpReady).catch(e=>i["a"].error("Peer _createAnswer error:",e))}_setLocalDescription(e){const{useStereo:t,googleMaxBitrate:n,googleMinBitrate:i,googleStartBitrate:o}=this.options;return t&&(e.sdp=Re(e.sdp)),n&&i&&o&&(e.sdp=Qe(e.sdp,n,i,o)),this.instance.setLocalDescription(e)}_sdpReady(){Object(p["e"])(this.onSdpReadyTwice)&&this.onSdpReadyTwice(this.instance.localDescription)}_retrieveLocalStream(){return We(this,void 0,void 0,(function*(){if(be(this.options.localStream))return this.options.localStream;const e=yield Ae(this.options);return Oe(e)}))}_isOffer(){return this.type===Q.Offer}_isAnswer(){return this.type===Q.Answer}_config(){const{iceServers:e=[]}=this.options,t={sdpSemantics:"unified-plan",bundlePolicy:"max-compat",iceServers:e};return i["a"].info("RTC config",t),t}}const Ze=(e,t)=>{const{contentType:n,canvasType:i,callID:o,canvasInfo:s=null,currentLayerIdx:r=-1}=t;s&&"mcu-personal-canvas"!==i&&delete s.memberID;const a={type:Z.conferenceUpdate,call:e.calls[o],canvasInfo:Xe(s),currentLayerIdx:r};switch(n){case"layer-info":{const t=Object.assign({action:ne.LayerInfo},a);w(f["f"].Notification,t,e.uuid);break}case"layout-info":{const t=Object.assign({action:ne.LayoutInfo},a);w(f["f"].Notification,t,e.uuid);break}}},Xe=e=>{const t=JSON.stringify(e).replace(/memberID/g,"participantId").replace(/ID"/g,'Id"').replace(/POS"/g,'Pos"');return Object(p["j"])(t)};var et=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function r(e){try{c(i.next(e))}catch(t){s(t)}}function a(e){try{c(i["throw"](e))}catch(t){s(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};class tt{constructor(e,t){this.session=e,this.id="",this.state=ee[ee.New],this.prevState="",this.channels=[],this.role=te.Participant,this.extension=null,this._state=ee.New,this._prevState=ee.New,this.gotAnswer=!1,this.gotEarly=!1,this._lastSerno=0,this._targetNodeId=null,this._iceTimeout=null,this._iceDone=!1,this._checkConferenceSerno=e=>{const t=e<0||!this._lastSerno||this._lastSerno&&e===this._lastSerno+1;return t&&e>=0&&(this._lastSerno=e),t};const{iceServers:n,speaker:i,micId:o,micLabel:s,camId:r,camLabel:a,localElement:c,remoteElement:l,mediaConstraints:{audio:u,video:d}}=e;this.options=Object.assign({},X,{audio:u,video:d,iceServers:n,localElement:c,remoteElement:l,micId:o,micLabel:s,camId:r,camLabel:a,speakerId:i},t),this._onMediaError=this._onMediaError.bind(this),this._init()}get nodeId(){return this._targetNodeId}set nodeId(e){this._targetNodeId=e}get localStream(){return this.options.localStream}get remoteStream(){return this.options.remoteStream}get memberChannel(){return"conference-member."+this.id}invite(){this.direction=W.Outbound,this.peer=new Ye(Q.Offer,this.options),this._registerPeerEvents()}answer(){this.direction=W.Inbound,this.peer=new Ye(Q.Answer,this.options),this._registerPeerEvents()}hangup(e={},t=!0){this.cause=e.cause||"NORMAL_CLEARING",this.causeCode=e.causeCode||16,this.setState(ee.Hangup);const n=()=>{this.peer&&this.peer.instance.close(),this.setState(ee.Destroy)};if(t){const e=new ae({sessid:this.session.sessionid,dialogParams:this.options});this._execute(e).catch(e=>i["a"].error("verto.bye failed!",e)).then(n.bind(this))}else n()}transfer(e){const t=new ce({sessid:this.session.sessionid,action:"transfer",destination:e,dialogParams:this.options});this._execute(t)}replace(e){const t=new ce({sessid:this.session.sessionid,action:"replace",replaceCallID:e,dialogParams:this.options});this._execute(t)}hold(){const e=new ce({sessid:this.session.sessionid,action:"hold",dialogParams:this.options});return this._execute(e).then(this._handleChangeHoldStateSuccess.bind(this)).catch(this._handleChangeHoldStateError.bind(this))}unhold(){const e=new ce({sessid:this.session.sessionid,action:"unhold",dialogParams:this.options});return this._execute(e).then(this._handleChangeHoldStateSuccess.bind(this)).catch(this._handleChangeHoldStateError.bind(this))}toggleHold(){const e=new ce({sessid:this.session.sessionid,action:"toggleHold",dialogParams:this.options});return this._execute(e).then(this._handleChangeHoldStateSuccess.bind(this)).catch(this._handleChangeHoldStateError.bind(this))}dtmf(e){const t=new le({sessid:this.session.sessionid,dtmf:e,dialogParams:this.options});this._execute(t)}message(e,t){const n={from:this.session.options.login,to:e,body:t},i=new le({sessid:this.session.sessionid,msg:n,dialogParams:this.options});this._execute(i)}muteAudio(){Fe(this.options.localStream)}unmuteAudio(){qe(this.options.localStream)}toggleAudioMute(){He(this.options.localStream)}setAudioInDevice(e){return et(this,void 0,void 0,(function*(){const{instance:t}=this.peer,n=t.getSenders().find(({track:{kind:e}})=>"audio"===e);if(n){const t=yield ve({audio:{deviceId:{exact:e}}}),i=t.getAudioTracks()[0];n.replaceTrack(i),this.options.micId=e;const{localStream:o}=this.options;o.getAudioTracks().forEach(e=>e.stop()),o.getVideoTracks().forEach(e=>t.addTrack(e)),this.options.localStream=t}}))}muteVideo(){Ge(this.options.localStream)}unmuteVideo(){Je(this.options.localStream)}toggleVideoMute(){ze(this.options.localStream)}setVideoDevice(e){return et(this,void 0,void 0,(function*(){const{instance:t}=this.peer,n=t.getSenders().find(({track:{kind:e}})=>"video"===e);if(n){const t=yield ve({video:{deviceId:{exact:e}}}),i=t.getVideoTracks()[0];n.replaceTrack(i);const{localElement:o,localStream:s}=this.options;_e(o,t),this.options.camId=e,s.getAudioTracks().forEach(e=>t.addTrack(e)),s.getVideoTracks().forEach(e=>e.stop()),this.options.localStream=t}}))}deaf(){Fe(this.options.remoteStream)}undeaf(){qe(this.options.remoteStream)}toggleDeaf(){He(this.options.remoteStream)}setState(e){switch(this._prevState=this._state,this._state=e,this.state=ee[this._state].toLowerCase(),this.prevState=ee[this._prevState].toLowerCase(),i["a"].info(`Call ${this.id} state change from ${this.prevState} to ${this.state}`),this._dispatchNotification({type:Z.callUpdate,call:this}),e){case ee.Purge:this.hangup({cause:"PURGE",causeCode:"01"},!1);break;case ee.Active:setTimeout(()=>{const{remoteElement:e,speakerId:t}=this.options;e&&t&&Ie(e,t)},0);break;case ee.Destroy:this._finalize();break}}handleMessage(e){const{method:t,params:n}=e;switch(t){case Y.Answer:if(this.gotAnswer=!0,this._state>=ee.Active)return;this._state>=ee.Early&&this.setState(ee.Active),this.gotEarly||this._onRemoteSdp(n.sdp);break;case Y.Media:if(this._state>=ee.Early)return;this.gotEarly=!0,this._onRemoteSdp(n.sdp);break;case Y.Display:case Y.Attach:{const{display_name:e,display_number:i,display_direction:o}=n;this.extension=i;const s=o===W.Inbound?W.Outbound:W.Inbound,r={type:Z[t],call:this,displayName:e,displayNumber:i,displayDirection:s};w(f["f"].Notification,r,this.id)||w(f["f"].Notification,r,this.session.uuid);break}case Y.Info:case Y.Event:{const e=Object.assign(Object.assign({},n),{type:Z.generic,call:this});w(f["f"].Notification,e,this.id)||w(f["f"].Notification,e,this.session.uuid);break}case Y.Bye:this.hangup(n,!1);break}}handleConferenceUpdate(e,t){return et(this,void 0,void 0,(function*(){if(!this._checkConferenceSerno(e.wireSerno)&&e.name!==t.laName)return i["a"].error("ConferenceUpdate invalid wireSerno or packet name:",e),"INVALID_PACKET";const{action:n,data:o,hashKey:s=String(this._lastSerno),arrIndex:r}=e;switch(n){case"bootObj":{this._lastSerno=0;const{chatID:e,chatChannel:n,infoChannel:i,modChannel:s,laName:r,conferenceMemberID:a,role:c}=t;this._dispatchConferenceUpdate({action:ne.Join,conferenceName:r,participantId:Number(a),role:c}),n&&(yield this._subscribeConferenceChat(n)),i&&(yield this._subscribeConferenceInfo(i)),s&&c===te.Moderator&&(yield this._subscribeConferenceModerator(s));const l=[];for(const t in o)l.push(Object.assign({callId:o[t][0],index:Number(t)},Object(p["f"])(o[t][1])));this._dispatchConferenceUpdate({action:ne.Bootstrap,participants:l});break}case"add":this._dispatchConferenceUpdate(Object.assign({action:ne.Add,callId:s,index:r},Object(p["f"])(o)));break;case"modify":this._dispatchConferenceUpdate(Object.assign({action:ne.Modify,callId:s,index:r},Object(p["f"])(o)));break;case"del":this._dispatchConferenceUpdate(Object.assign({action:ne.Delete,callId:s,index:r},Object(p["f"])(o)));break;case"clear":this._dispatchConferenceUpdate({action:ne.Clear});break;default:this._dispatchConferenceUpdate({action:n,data:o,callId:s,index:r});break}}))}_addChannel(e){this.channels.includes(e)||this.channels.push(e);const t=this.session.relayProtocol;this.session._existsSubscription(t,e)&&(this.session.subscriptions[t][e]=Object.assign(Object.assign({},this.session.subscriptions[t][e]),{callId:this.id}))}_subscribeConferenceChat(e){return et(this,void 0,void 0,(function*(){const t={nodeId:this.nodeId,channels:[e],handler:e=>{const{direction:t,from:n,fromDisplay:i,message:o,type:s}=e.data;this._dispatchConferenceUpdate({action:ne.ChatMessage,direction:t,participantNumber:n,participantName:i,messageText:o,messageType:s,messageId:e.eventSerno})}},n=yield this.session.vertoSubscribe(t).catch(e=>{i["a"].error("ConfChat subscription error:",e)});$e(n,e)&&(this._addChannel(e),Object.defineProperties(this,{sendChatMessage:{configurable:!0,value:(t,n)=>{this.session.vertoBroadcast({nodeId:this.nodeId,channel:e,data:{action:"send",message:t,type:n}})}}}))}))}_subscribeConferenceInfo(e){return et(this,void 0,void 0,(function*(){const t={nodeId:this.nodeId,channels:[e],handler:e=>{const{eventData:t}=e;switch(t.contentType){case"layout-info":t.callID=this.id,Ze(this.session,t);break;default:i["a"].error("Conference-Info unknown contentType",e)}}},n=yield this.session.vertoSubscribe(t).catch(e=>{i["a"].error("ConfInfo subscription error:",e)});$e(n,e)&&this._addChannel(e)}))}_confControl(e,t={}){const n=Object.assign({application:"conf-control",callID:this.id,value:null},t);this.session.vertoBroadcast({nodeId:this.nodeId,channel:e,data:n})}_subscribeConferenceModerator(e){return et(this,void 0,void 0,(function*(){const t=(t,n=null,i=null)=>{const o=parseInt(n)||null;this._confControl(e,{command:t,id:o,value:i})},n=()=>{const{video:e}=this.options;if("boolean"===typeof e&&!e||"object"===typeof e&&Object(p["h"])(e))throw`Conference ${this.id} has no video!`},o={nodeId:this.nodeId,channels:[e],handler:e=>{const{data:t}=e;switch(t["conf-command"]){case"list-videoLayouts":if(t.responseData){const e=JSON.stringify(t.responseData).replace(/IDS"/g,'Ids"');this._dispatchConferenceUpdate({action:ne.LayoutList,layouts:JSON.parse(e)})}break;default:this._dispatchConferenceUpdate({action:ne.ModCmdResponse,command:t["conf-command"],response:t.response})}}},s=yield this.session.vertoSubscribe(o).catch(e=>{i["a"].error("ConfMod subscription error:",e)});$e(s,e)&&(this.role=te.Moderator,this._addChannel(e),Object.defineProperties(this,{listVideoLayouts:{configurable:!0,value:()=>{t("list-videoLayouts")}},playMedia:{configurable:!0,value:e=>{t("play",null,e)}},stopMedia:{configurable:!0,value:()=>{t("stop",null,"all")}},deaf:{configurable:!0,value:e=>{t("deaf",e)}},undeaf:{configurable:!0,value:e=>{t("undeaf",e)}},startRecord:{configurable:!0,value:e=>{t("recording",null,["start",e])}},stopRecord:{configurable:!0,value:()=>{t("recording",null,["stop","all"])}},snapshot:{configurable:!0,value:e=>{n(),t("vid-write-png",null,e)}},setVideoLayout:{configurable:!0,value:(e,i)=>{n();const o=i?[e,i]:e;t("vid-layout",null,o)}},kick:{configurable:!0,value:e=>{t("kick",e)}},muteMic:{configurable:!0,value:e=>{t("tmute",e)}},muteVideo:{configurable:!0,value:e=>{n(),t("tvmute",e)}},presenter:{configurable:!0,value:e=>{n(),t("vid-res-id",e,"presenter")}},videoFloor:{configurable:!0,value:e=>{n(),t("vid-floor",e,"force")}},banner:{configurable:!0,value:(e,i)=>{n(),t("vid-banner",e,encodeURI(i))}},volumeDown:{configurable:!0,value:e=>{t("volume_out",e,"down")}},volumeUp:{configurable:!0,value:e=>{t("volume_out",e,"up")}},gainDown:{configurable:!0,value:e=>{t("volume_in",e,"down")}},gainUp:{configurable:!0,value:e=>{t("volume_in",e,"up")}},transfer:{configurable:!0,value:(e,n)=>{t("transfer",e,n)}}}))}))}_handleChangeHoldStateSuccess(e){return"active"===e.holdState?this.setState(ee.Active):this.setState(ee.Held),!0}_handleChangeHoldStateError(e){return i["a"].error(`Failed to ${e.action} on call ${this.id}`),!1}_onRemoteSdp(e){let t=Ve(e,this.peer.instance.localDescription.sdp);this.options.useStereo&&(t=Re(t));const n=ke({sdp:t,type:Q.Answer});this.peer.instance.setRemoteDescription(n).then(()=>{this.gotEarly&&this.setState(ee.Early),this.gotAnswer&&this.setState(ee.Active)}).catch(e=>{i["a"].error("Call setRemoteDescription Error: ",e),this.hangup()})}_requestAnotherLocalDescription(){Object(p["e"])(this.peer.onSdpReadyTwice)?w(f["f"].Error,new Error("SDP without candidates for the second time!"),this.session.uuid):(Object.defineProperty(this.peer,"onSdpReadyTwice",{value:this._onIceSdp.bind(this)}),this._iceDone=!1,this.peer.startNegotiation())}_onIceSdp(e){this._iceTimeout&&clearTimeout(this._iceTimeout),this._iceTimeout=null,this._iceDone=!0;const{sdp:t,type:n}=e;if(-1===t.indexOf("candidate"))return void this._requestAnotherLocalDescription();let o=null;const s={sessid:this.session.sessionid,sdp:t,dialogParams:this.options};switch(n){case Q.Offer:this.setState(ee.Requesting),o=new oe(s);break;case Q.Answer:this.setState(ee.Answering),o=!0===this.options.attach?new re(s):new se(s);break;default:return i["a"].error(this.id+" - Unknown local SDP type:",e),this.hangup({},!1)}this._execute(o).then(e=>{const{node_id:t=null}=e;this._targetNodeId=t,n===Q.Offer?this.setState(ee.Trying):this.setState(ee.Active)}).catch(e=>{i["a"].error(`${this.id} - Sending ${n} error:`,e),this.hangup()})}_registerPeerEvents(){const{instance:e}=this.peer;this._iceDone=!1,e.onicecandidate=t=>{this._iceDone||(null===this._iceTimeout&&(this._iceTimeout=setTimeout(()=>this._onIceSdp(e.localDescription),1e3)),t.candidate?i["a"].info("IceCandidate:",t.candidate):this._onIceSdp(e.localDescription))},e.addEventListener("track",e=>{this.options.remoteStream=e.streams[0];const{remoteElement:t,remoteStream:n,screenShare:i}=this.options;!1===i&&_e(t,n)}),e.addEventListener("addstream",e=>{this.options.remoteStream=e.stream})}_onMediaError(e){this._dispatchNotification({type:Z.userMediaError,error:e}),this.hangup({},!1)}_dispatchConferenceUpdate(e){this._dispatchNotification(Object.assign({type:Z.conferenceUpdate,call:this},e))}_dispatchNotification(e){!0!==this.options.screenShare&&(w(f["f"].Notification,e,this.id,!1)||w(f["f"].Notification,e,this.session.uuid))}_execute(e){return this.nodeId&&(e.targetNodeId=this.nodeId),this.session.execute(e)}_init(){const{id:e,userVariables:t,remoteCallerNumber:n,onNotification:o}=this.options;e||(this.options.id=h()),this.id=this.options.id,t&&!Object(p["h"])(t)||(this.options.userVariables=this.session.options.userVariables||{}),n||(this.options.remoteCallerNumber=this.options.destinationNumber),this.session.calls[this.id]=this,y(f["f"].MediaError,this._onMediaError,this.id),Object(p["e"])(o)&&y(f["f"].Notification,o.bind(this),this.id),this.setState(ee.New),i["a"].info("New Call with Options:",this.options)}_finalize(){const{remoteStream:e,localStream:t,remoteElement:n,localElement:i}=this.options;xe(e),xe(t),!0!==this.options.screenShare&&(we(n),we(i)),_(f["f"].MediaError,null,this.id),this.peer=null,this.session.calls[this.id]=null,delete this.session.calls[this.id]}}var nt=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function r(e){try{c(i.next(e))}catch(t){s(t)}}function a(e){try{c(i["throw"](e))}catch(t){s(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};class it extends tt{constructor(){super(...arguments),this._statsInterval=null}hangup(e={},t=!0){this.screenShare instanceof it&&this.screenShare.hangup(e,t),super.hangup(e,t)}startScreenShare(e){return nt(this,void 0,void 0,(function*(){const t=yield ge({video:!0});t.getTracks().forEach(e=>{e.addEventListener("ended",()=>{this.screenShare&&this.screenShare.hangup()})});const{remoteCallerName:n,remoteCallerNumber:i,callerName:o,callerNumber:s}=this.options,r=Object.assign({screenShare:!0,localStream:t,destinationNumber:this.extension+"-screen",remoteCallerName:n,remoteCallerNumber:i+"-screen",callerName:o+" (Screen)",callerNumber:s+" (Screen)"},e);return this.screenShare=new it(this.session,r),this.screenShare.invite(),this.screenShare}))}stopScreenShare(){this.screenShare instanceof it&&this.screenShare.hangup()}setAudioOutDevice(e){return nt(this,void 0,void 0,(function*(){this.options.speakerId=e;const{remoteElement:t,speakerId:n}=this.options;return!(!t||!n)&&Ie(t,n)}))}_finalize(){this._stats(!1),super._finalize()}_stats(e=!0){if(!1===e)return clearInterval(this._statsInterval);i["a"].setLevel(2),this._statsInterval=window.setInterval(()=>nt(this,void 0,void 0,(function*(){const e=yield this.peer.instance.getStats(null);let t="";const n=["certificate","codec","peer-connection","stream","local-candidate","remote-candidate"],o=["id","type","timestamp"];e.forEach(e=>{n.includes(e.type)||(t+=`\n${e.type}\n`,Object.keys(e).forEach(n=>{o.includes(n)||(t+=`\t${n}: ${e[n]}\n`)}))}),i["a"].info(t)})),2e3)}}var ot=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function r(e){try{c(i.next(e))}catch(t){s(t)}}function a(e){try{c(i["throw"](e))}catch(t){s(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};class st{constructor(e){this.session=e}_ack(e,t){const n=new K(e,t);this.nodeId&&(n.targetNodeId=this.nodeId),this.session.execute(n)}handleMessage(e){const{session:t}=this,{id:n,method:o,params:s}=e,{callID:r,eventChannel:a,eventType:c}=s,l=o===Y.Attach;if("channelPvtData"===c)return this._handlePvtEvent(s.pvtData);if(r&&t.calls.hasOwnProperty(r)){if(!l)return t.calls[r].handleMessage(e),void this._ack(n,o);t.calls[r].hangup({},!1)}const u=()=>{const e=new it(t,{id:r,remoteSdp:s.sdp,destinationNumber:s.callee_id_number,remoteCallerName:s.caller_id_name,remoteCallerNumber:s.caller_id_number,callerName:s.callee_id_name,callerNumber:s.callee_id_number,attach:l});return e.nodeId=this.nodeId,e};switch(o){case Y.Punt:t.disconnect();break;case Y.Invite:{const e=u();e.setState(ee.Ringing),this._ack(n,o);break}case Y.Attach:{const t=u();this.session.autoRecoverCalls?t.answer():t.setState(ee.Recovering),t.handleMessage(e);break}case Y.Event:case"webrtc.event":if(!a)return void i["a"].error("Verto received an unknown event:",s);const r=t.relayProtocol,c=a.split(".")[0];t._existsSubscription(r,a)?w(r,s,a):a===t.sessionid?this._handleSessionEvent(s.eventData):t._existsSubscription(r,c)?w(r,s,c):t.calls.hasOwnProperty(a)?t.calls[a].handleMessage(e):w(f["f"].Notification,s,t.uuid);break;case Y.Info:s.type=Z.generic,w(f["f"].Notification,s,t.uuid);break;case Y.ClientReady:s.type=Z.vertoClientReady,w(f["f"].Notification,s,t.uuid);break;default:i["a"].warn("Verto message unknown method:",e)}}_retrieveCallId(e,t){const n=Object.keys(this.session.calls);if("bootObj"!==e.action)return n.find(e=>this.session.calls[e].channels.includes(t));{const t=e.data.find(e=>n.includes(e[0]));if(t instanceof Array)return t[0]}}_handlePvtEvent(e){return ot(this,void 0,void 0,(function*(){const{session:t}=this,n=t.relayProtocol,{action:o,laChannel:s,laName:r,chatChannel:a,infoChannel:c,modChannel:l,conferenceMemberID:u,role:d,callID:h}=e;switch(o){case"conference-liveArray-join":{const n=()=>{t.vertoBroadcast({nodeId:this.nodeId,channel:s,data:{liveArray:{command:"bootstrap",context:s,name:r}}})},o={nodeId:this.nodeId,channels:[s],handler:({data:i})=>{const o=h||this._retrieveCallId(i,s);if(o&&t.calls.hasOwnProperty(o)){const a=t.calls[o];a._addChannel(s),a.extension=r,a.handleConferenceUpdate(i,e).then(e=>{"INVALID_PACKET"===e&&n()})}}},a=yield t.vertoSubscribe(o).catch(e=>{i["a"].error("liveArray subscription error:",e)});$e(a,s)&&n();break}case"conference-liveArray-part":{let e=null;if(s&&t._existsSubscription(n,s)){const{callId:i=null}=t.subscriptions[n][s];if(e=t.calls[i]||null,null!==i){const n={type:Z.conferenceUpdate,action:ne.Leave,conferenceName:r,participantId:Number(u),role:d};w(f["f"].Notification,n,i,!1)||w(f["f"].Notification,n,t.uuid),null===e&&_(f["f"].Notification,null,i)}}const o=[s,a,c,l];t.vertoUnsubscribe({nodeId:this.nodeId,channels:o}).then(({unsubscribedChannels:t=[]})=>{e&&(e.channels=e.channels.filter(e=>!t.includes(e)))}).catch(e=>{i["a"].error("liveArray unsubscribe error:",e)});break}}}))}_handleSessionEvent(e){switch(e.contentType){case"layout-info":case"layer-info":Ze(this.session,e);break;case"logo-info":{const t={type:Z.conferenceUpdate,action:ne.LogoInfo,logo:e.logoURL};w(f["f"].Notification,t,this.session.uuid);break}}}}var rt=st,at=(e,t)=>{const{protocol:n,event:o,params:s}=t,{event_type:r,node_id:a}=s;if(n!==e.relayProtocol)return i["a"].error("Session protocol mismatch.");switch(o){case"queuing.relay.events":if("webrtc.message"===r){const t=new rt(e);t.nodeId=a,t.handleMessage(s.params)}else e.calling.notificationHandler(s);break;case"queuing.relay.tasks":e.tasking.notificationHandler(s);break;case"queuing.relay.messaging":e.messaging.notificationHandler(s);break;default:return i["a"].error("Unknown notification type: "+r)}},ct=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function r(e){try{c(i.next(e))}catch(t){s(t)}}function a(e){try{c(i["throw"](e))}catch(t){s(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};const lt=1e4;class ut{constructor(e){if(this.options=e,this.uuid=h(),this.sessionid="",this.subscriptions={},this.expiresAt=0,this.signature=null,this.relayProtocol=null,this.contexts=[],this.timeoutErrorCode=-32e3,this.connection=null,this._jwtAuth=!1,this._doKeepAlive=!1,this._autoReconnect=!0,this._idle=!1,this._executeQueue=[],!this.validateOptions())throw new Error("Invalid init options");this._onSocketOpen=this._onSocketOpen.bind(this),this._onSocketCloseOrError=this._onSocketCloseOrError.bind(this),this._onSocketMessage=this._onSocketMessage.bind(this),this._handleLoginError=this._handleLoginError.bind(this),this._checkTokenExpiration=this._checkTokenExpiration.bind(this),this._attachListeners(),this.connection=new C(this)}get __logger(){return i["a"]}get connected(){return this.connection&&this.connection.connected}get expired(){return this.expiresAt&&this.expiresAt<=Date.now()/1e3}get reconnectDelay(){return 1e3*Object(p["i"])(6,2)}execute(e){return this._idle?new Promise(t=>this._executeQueue.push({resolve:t,msg:e})):this.connected?this.connection.send(e).catch(e=>{throw e.code&&e.code===this.timeoutErrorCode&&this._closeConnection(),e}):new Promise(t=>{this._executeQueue.push({resolve:t,msg:e}),this.connect()})}executeRaw(e){this._idle?this._executeQueue.push({msg:e}):this.connection.sendRawText(e)}validateOptions(){const{project:e=!1,token:t=!1}=this.options;return Boolean(e&&t)}broadcast(e){}subscribe({protocol:e,channels:t,handler:n}){return ct(this,void 0,void 0,(function*(){const i=new R({command:f["a"],protocol:e,channels:t}),o=yield this.execute(i),{failed_channels:s=[],subscribe_channels:r=[]}=o;return s.length&&s.forEach(t=>this._removeSubscription(e,t)),r.forEach(t=>this._addSubscription(e,n,t)),o}))}unsubscribe({protocol:e,channels:t,handler:n}){return ct(this,void 0,void 0,(function*(){const n=new R({command:f["c"],protocol:e,channels:t});return this.execute(n)}))}disconnect(){return ct(this,void 0,void 0,(function*(){clearTimeout(this._reconnectTimeout),this.subscriptions={},this._autoReconnect=!1,this.relayProtocol=null,this._closeConnection(),yield V["b"].removeItem(this.signature),this._executeQueue=[],this._detachListeners()}))}on(e,t){return y(e,t,this.uuid),this}off(e,t){return _(e,t,this.uuid),this}refreshToken(e){return ct(this,void 0,void 0,(function*(){this.options.token=e;try{if(this.expired)yield this.connect();else{const t=new M(this.options.project,e,this.sessionid),n=yield this.execute(t),{authorization:{expires_at:i=null}={}}=n;this.expiresAt=+i||0}}catch(t){i["a"].error("refreshToken error:",t),w(f["f"].Error,t,this.uuid,!1)}}))}connect(){return ct(this,void 0,void 0,(function*(){this.connection||(this.connection=new C(this)),this._attachListeners(),this.connection.isAlive||this.connection.connect()}))}_handleLoginError(e){w(f["f"].Error,e,this.uuid)}_onSocketOpen(){return ct(this,void 0,void 0,(function*(){this._idle=!1;const e=this._jwtAuth?"jwt_token":"token",{project:t,token:n}=this.options,o=new j({project:t,[e]:n},this.sessionid),s=yield this.execute(o).catch(this._handleLoginError);if(s){this._autoReconnect=!0;const{sessionid:e,nodeid:t,master_nodeid:n,authorization:{expires_at:o=null,signature:r=null}={}}=s;this.expiresAt=+o||0,this.signature=r,this.relayProtocol=yield H(this),this._checkTokenExpiration(),this.sessionid=e,this.nodeid=t,this.master_nodeid=n,this._emptyExecuteQueues(),this._pong=null,this._keepAlive(),w(f["f"].Ready,this,this.uuid),i["a"].info("Session Ready!")}}))}_onSocketCloseOrError(e){i["a"].error(`Socket ${e.type} ${e.message}`),this.relayProtocol&&S(this.relayProtocol);for(const t in this.subscriptions)S(t);this.subscriptions={},this.contexts=[],this.expired&&(this._idle=!0,this._autoReconnect=!1,this.expiresAt=0),this._autoReconnect&&(this._reconnectTimeout=setTimeout(()=>this.connect(),this.reconnectDelay))}_onSocketMessage(e){const{method:t,params:n}=e;switch(t){case f["b"].Broadcast:at(this,n);break;case f["b"].Disconnect:this._idle=!0;break}}_removeSubscription(e,t){this._existsSubscription(e,t)&&(t?(delete this.subscriptions[e][t],_(e,null,t)):(delete this.subscriptions[e],S(e)))}_addSubscription(e,t=null,n){this._existsSubscription(e,n)||(this._existsSubscription(e)||(this.subscriptions[e]={}),this.subscriptions[e][n]={},Object(p["e"])(t)&&y(e,t,n))}_existsSubscription(e,t){return!(!this.subscriptions.hasOwnProperty(e)||!(!t||t&&this.subscriptions[e].hasOwnProperty(t)))}_attachListeners(){this._detachListeners(),this.on(f["f"].SocketOpen,this._onSocketOpen),this.on(f["f"].SocketClose,this._onSocketCloseOrError),this.on(f["f"].SocketError,this._onSocketCloseOrError),this.on(f["f"].SocketMessage,this._onSocketMessage)}_detachListeners(){this.off(f["f"].SocketOpen,this._onSocketOpen),this.off(f["f"].SocketClose,this._onSocketCloseOrError),this.off(f["f"].SocketError,this._onSocketCloseOrError),this.off(f["f"].SocketMessage,this._onSocketMessage)}_emptyExecuteQueues(){this._executeQueue.forEach(({resolve:e,msg:t})=>{"string"===typeof t?this.executeRaw(t):e(this.execute(t))})}_closeConnection(){this._idle=!0,clearTimeout(this._keepAliveTimeout),this.connection&&this.connection.close()}_checkTokenExpiration(){if(!this.expiresAt)return;const e=this.expiresAt-Date.now()/1e3;e<=60&&(i["a"].warn("Your JWT is going to expire. You should refresh it to keep the session live."),w(f["f"].Notification,{type:Z.refreshToken,session:this},this.uuid,!1)),this.expired||setTimeout(this._checkTokenExpiration,3e4)}_keepAlive(){if(!0===this._doKeepAlive){if(!1===this._pong)return this._closeConnection();this._pong=!1,this.execute(new U).then(()=>this._pong=!0).catch(()=>this._pong=!1),this._keepAliveTimeout=setTimeout(()=>this._keepAlive(),lt)}}static on(e,t){y(e,t)}static off(e){_(e)}static uuid(){return h()}}var dt=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function r(e){try{c(i.next(e))}catch(t){s(t)}}function a(e){try{c(i["throw"](e))}catch(t){s(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))},ht=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(n[i[o]]=e[i[o]])}return n};class ft extends ut{constructor(){super(...arguments),this.calls={},this.autoRecoverCalls=!0,this._iceServers=[],this._localElement=null,this._remoteElement=null,this._jwtAuth=!0,this._devices={},this._audioConstraints=!0,this._videoConstraints=!1,this._speaker=null}get reconnectDelay(){return 1e3}connect(){const e=Object.create(null,{connect:{get:()=>super.connect}});return dt(this,void 0,void 0,(function*(){this.sessionid=yield V["a"].getItem(f["d"]),e.connect.call(this)}))}checkPermissions(e=!0,t=!0){return dt(this,void 0,void 0,(function*(){try{const n=yield Oe({audio:e,video:t});return xe(n),!0}catch(n){return!1}}))}logout(){this.disconnect()}disconnect(){const e=Object.create(null,{disconnect:{get:()=>super.disconnect}});return dt(this,void 0,void 0,(function*(){Object.keys(this.calls).forEach(e=>this.calls[e].setState(ee.Purge)),this.calls={},yield e.disconnect.call(this)}))}speedTest(e){return new Promise((t,n)=>{if(b(f["f"].SpeedTest,n=>{const{upDur:i,downDur:o}=n,s=i?8*e/(i/1e3)/1024:0,r=o?8*e/(o/1e3)/1024:0;t({upDur:i,downDur:o,upKps:s.toFixed(0),downKps:r.toFixed(0)})},this.uuid),e=Number(e),!e)return n("Invalid parameter 'bytes': "+e);this.executeRaw("#SPU "+e);let i=e/1024;e%1024&&i++;const o=".".repeat(1024);for(let e=0;e<i;e++)this.executeRaw("#SPB "+o);this.executeRaw("#SPE")})}getDevices(){return Ne().catch(e=>(w(f["f"].MediaError,e,this.uuid),[]))}getVideoDevices(){return Ne(ie.Video).catch(e=>(w(f["f"].MediaError,e,this.uuid),[]))}getAudioInDevices(){return Ne(ie.AudioIn).catch(e=>(w(f["f"].MediaError,e,this.uuid),[]))}getAudioOutDevices(){return Ne(ie.AudioOut).catch(e=>(w(f["f"].MediaError,e,this.uuid),[]))}validateDeviceId(e,t,n){return De(e,t,n)}refreshDevices(){return dt(this,void 0,void 0,(function*(){i["a"].warn("This method has been deprecated. Use getDevices() instead.");const e={};["videoinput","audioinput","audiooutput"].map(t=>{e[t]={},Object.defineProperty(e[t],"toArray",{value:function(){return Object.keys(this).map(e=>this[e])}})});const t=yield this.getDevices();return t.forEach(t=>{e.hasOwnProperty(t.kind)&&(e[t.kind][t.deviceId]=t)}),this._devices=e,this.devices}))}get devices(){return this._devices||{}}getDeviceResolutions(e){return dt(this,void 0,void 0,(function*(){try{return yield Pe(e)}catch(t){throw t}}))}get videoDevices(){return i["a"].warn("This property has been deprecated. Use getVideoDevices() instead."),this._devices.videoinput||{}}get audioInDevices(){return i["a"].warn("This property has been deprecated. Use getAudioInDevices() instead."),this._devices.audioinput||{}}get audioOutDevices(){return i["a"].warn("This property has been deprecated. Use getAudioOutDevices() instead."),this._devices.audiooutput||{}}get mediaConstraints(){return{audio:this._audioConstraints,video:this._videoConstraints}}setAudioSettings(e){return dt(this,void 0,void 0,(function*(){const{micId:t,micLabel:n}=e,i=ht(e,["micId","micLabel"]);return je(i),this._audioConstraints=yield Te(t,n,"audioinput",i),this.micId=t,this.micLabel=n,this._audioConstraints}))}disableMicrophone(){this._audioConstraints=!1}enableMicrophone(){this._audioConstraints=!0}setVideoSettings(e){return dt(this,void 0,void 0,(function*(){const{camId:t,camLabel:n}=e,i=ht(e,["camId","camLabel"]);return je(i),this._videoConstraints=yield Te(t,n,"videoinput",i),this.camId=t,this.camLabel=n,this._videoConstraints}))}disableWebcam(){this._videoConstraints=!1}enableWebcam(){this._videoConstraints=!0}set iceServers(e){this._iceServers="boolean"===typeof e?e?[{urls:["stun:stun.l.google.com:19302"]}]:[]:e}get iceServers(){return this._iceServers}set speaker(e){this._speaker=e}get speaker(){return this._speaker}set localElement(e){this._localElement=Object(p["c"])(e)}get localElement(){return this._localElement}set remoteElement(e){this._remoteElement=Object(p["c"])(e)}get remoteElement(){return this._remoteElement}vertoBroadcast({nodeId:e,channel:t="",data:n}){if(!t)throw new Error("Invalid channel for broadcast: "+t);const i=new ue({sessid:this.sessionid,eventChannel:t,data:n});e&&(i.targetNodeId=e),this.execute(i).catch(e=>e)}vertoSubscribe({nodeId:e,channels:t=[],handler:n}){return dt(this,void 0,void 0,(function*(){if(t=t.filter(e=>e&&!this._existsSubscription(this.relayProtocol,e)),!t.length)return{};const i=new de({sessid:this.sessionid,eventChannel:t});e&&(i.targetNodeId=e);const o=yield this.execute(i),{unauthorized:s=[],subscribed:r=[]}=Be(o);return s.length&&s.forEach(e=>this._removeSubscription(this.relayProtocol,e)),r.forEach(e=>this._addSubscription(this.relayProtocol,n,e)),o}))}vertoUnsubscribe({nodeId:e,channels:t=[]}){return dt(this,void 0,void 0,(function*(){if(t=t.filter(e=>e&&this._existsSubscription(this.relayProtocol,e)),!t.length)return{};const n=new he({sessid:this.sessionid,eventChannel:t});e&&(n.targetNodeId=e);const i=yield this.execute(n),{unsubscribed:o=[],notSubscribed:s=[]}=Be(i);return o.forEach(e=>this._removeSubscription(this.relayProtocol,e)),s.forEach(e=>this._removeSubscription(this.relayProtocol,e)),i}))}}var pt=function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,s){function r(e){try{c(i.next(e))}catch(t){s(t)}}function a(e){try{c(i["throw"](e))}catch(t){s(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};class vt extends ft{execute(e){let t=e;if(e instanceof z){const n={message:e.request};e.targetNodeId&&(n.node_id=e.targetNodeId),t=new T({protocol:this.relayProtocol,method:"message",params:n})}return super.execute(t)}newCall(e){return pt(this,void 0,void 0,(function*(){const{destinationNumber:t=null}=e;if(!t)throw new TypeError("destinationNumber is required");const n=new it(this,e);return n.invite(),n}))}}const gt="1.2.8";D("JavaScript SDK/"+gt)},a15b:function(e,t,n){"use strict";var i=n("23e7"),o=n("e330"),s=n("44ad"),r=n("fc6a"),a=n("a640"),c=o([].join),l=s!=Object,u=a("join",",");i({target:"Array",proto:!0,forced:l||!u},{join:function(e){return c(r(this),void 0===e?",":e)}})},caad:function(e,t,n){"use strict";var i=n("23e7"),o=n("4d64").includes,s=n("44d2");i({target:"Array",proto:!0},{includes:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),s("includes")}}]);
//# sourceMappingURL=vendors~layout.js.map